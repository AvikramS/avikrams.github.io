<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Crush Studio - Spin to Win!</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Light gray background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden; /* Prevent scrollbar from appearing during spin */
        }
        .wheel-container {
            position: relative;
            width: 90vmin; /* Responsive width based on viewport */
            max-width: 500px; /* Max width for larger screens */
            height: 90vmin;
            max-height: 500px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 2rem;
        }
        canvas {
            border-radius: 50%;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1); /* Smooth spin transition */
            border: 8px solid #fff; /* White border around the wheel */
        }
        .pointer {
            position: absolute;
            top: -20px; /* Position above the wheel */
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 30px solid #ef4444; /* Red pointer */
            z-index: 10;
        }
        .spin-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(145deg, #60a5fa, #3b82f6); /* Blue gradient */
            color: white;
            font-weight: bold;
            font-size: 1.25rem;
            border: 6px solid #fff;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            line-height: 1.2;
        }
        .spin-button:hover:not(:disabled) {
            transform: translate(-50%, -50%) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        .spin-button:active:not(:disabled) {
            transform: translate(-50%, -50%) scale(0.98);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        .spin-button:disabled {
            background: #cbd5e1; /* Gray for disabled */
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25);
            text-align: center;
            max-width: 90%;
            width: 450px;
            transform: translateY(-20px);
            opacity: 0;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .modal-close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-500 to-purple-600 flex flex-col items-center justify-center p-4">

    <div class="bg-white p-8 rounded-2xl shadow-xl max-w-2xl w-full flex flex-col items-center">
        <h1 class="text-4xl font-extrabold text-gray-800 mb-6 text-center">Color Crush Studio</h1>
        <p id="spin-status" class="text-lg text-gray-600 mb-8 text-center">Spin the wheel to win exciting rewards!</p>

        <div class="wheel-container">
            <canvas id="spinWheel" width="500" height="500"></canvas>
            <div class="pointer"></div>
            <button id="spinButton" class="spin-button">SPIN</button>
        </div>

        <div id="resultDisplay" class="mt-8 text-center hidden">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Congratulations!</h2>
            <p class="text-xl text-gray-700 mb-4" id="winnerText"></p>
            <div id="couponSection" class="hidden">
                <p class="text-lg text-gray-600 mb-2">Your Coupon Code:</p>
                <div class="flex items-center justify-center mb-4">
                    <input type="text" id="couponCodeInput" readonly class="p-3 border border-gray-300 rounded-lg text-center text-2xl font-mono bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 w-full max-w-xs">
                    <button id="copyCouponButton" class="ml-3 px-6 py-3 bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500">Copy</button>
                </div>
            </div>
            <p class="text-md text-gray-500" id="noLuckMessage" style="display: none;">Better luck next time!</p>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="resultModalOverlay" class="modal-overlay">
        <div class="modal-content relative">
            <button id="closeModalButton" class="modal-close-button">&times;</button>
            <h2 class="text-3xl font-bold text-gray-800 mb-4" id="modalTitle"></h2>
            <p class="text-xl text-gray-700 mb-4" id="modalWinnerText"></p>
            <div id="modalCouponSection" class="hidden">
                <p class="text-lg text-gray-600 mb-2">Your Coupon Code:</p>
                <div class="flex items-center justify-center mb-4">
                    <input type="text" id="modalCouponCodeInput" readonly class="p-3 border border-gray-300 rounded-lg text-center text-2xl font-mono bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 w-full max-w-xs">
                    <button id="modalCopyCouponButton" class="ml-3 px-6 py-3 bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500">Copy</button>
                </div>
            </div>
            <p class="text-md text-gray-500" id="modalNoLuckMessage" style="display: none;">Better luck next time!</p>
            <button id="modalCloseButtonBottom" class="mt-6 px-8 py-3 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500">Close</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('spinWheel');
            const ctx = canvas.getContext('2d');
            const spinButton = document.getElementById('spinButton');
            const spinStatus = document.getElementById('spin-status');
            const resultDisplay = document.getElementById('resultDisplay');
            const winnerText = document.getElementById('winnerText');
            const couponSection = document.getElementById('couponSection');
            const couponCodeInput = document.getElementById('couponCodeInput');
            const copyCouponButton = document.getElementById('copyCouponButton');
            const noLuckMessage = document.getElementById('noLuckMessage');

            // Modal elements
            const resultModalOverlay = document.getElementById('resultModalOverlay');
            const closeModalButton = document.getElementById('closeModalButton');
            const modalCloseButtonBottom = document.getElementById('modalCloseButtonBottom');
            const modalTitle = document.getElementById('modalTitle');
            const modalWinnerText = document.getElementById('modalWinnerText');
            const modalCouponSection = document.getElementById('modalCouponSection');
            const modalCouponCodeInput = document.getElementById('modalCouponCodeInput');
            const modalCopyCouponButton = document.getElementById('modalCopyCouponButton');
            const modalNoLuckMessage = document.getElementById('modalNoLuckMessage');

            const wheelConfig = [
                { label: '10% OFF', winChance: 60, reward: '10% OFF', type: 'Reward', couponCode: 'COLORCRUSH10', color: '#FFD700' }, // Gold
                { label: 'No Luck', winChance: 8, reward: 'No Reward', type: 'No Reward', couponCode: '', color: '#9CA3AF' },   // Gray
                { label: '25% OFF', winChance: 1, reward: '25% OFF', type: 'Reward', couponCode: 'COLORCRUSH25', color: '#FF6347' }, // Tomato
                { label: '50% OFF', winChance: 1, reward: '50% OFF', type: 'Reward', couponCode: 'COLORCRUSH50', color: '#4CAF50' }, // Green
                { label: '20% OFF', winChance: 4, reward: '20% OFF', type: 'Reward', couponCode: 'COLORCRUSH20', color: '#8A2BE2' }, // BlueViolet
                { label: 'Free Consultation', winChance: 4, reward: 'Free Consultation', type: 'No Reward', couponCode: '', color: '#00CED1' }, // DarkTurquoise
                { label: '10% OFF ON NEXT VISIT', winChance: 5, reward: '10% OFF ON NEXT VISIT', type: 'Reward', couponCode: 'NEXT10', color: '#FF4500' }, // OrangeRed
                { label: '15% OFF ON NEXT VISIT', winChance: 6, reward: '15% OFF ON NEXT VISIT', type: 'Reward', couponCode: 'NEXT15', color: '#DA70D6' }, // Orchid
                { label: 'NO LUCK', winChance: 7, reward: 'No Reward', type: 'No Reward', couponCode: '', color: '#B0C4DE' },   // LightSteelBlue
                { label: '20% OFF ON NEXT VISIT', winChance: 4, reward: '20% OFF ON NEXT VISIT', type: 'Reward', couponCode: 'NEXT20', color: '#20B2AA' }  // LightSeaGreen
            ];

            const totalSlices = wheelConfig.length;
            const equalSliceAngle = (2 * Math.PI) / totalSlices; // Angle for each visually equal slice in radians

            const totalChance = wheelConfig.reduce((sum, slice) => sum + slice.winChance, 0);

            let currentRotation = 0;
            let isSpinning = false;

            // Check localStorage on page load
            const hasSpun = localStorage.getItem('hasSpunWheel');
            if (hasSpun === 'true') {
                spinButton.disabled = true;
                spinButton.textContent = 'SPUN';
                spinStatus.textContent = 'You have already spun the wheel.';
                spinButton.classList.add('opacity-70', 'cursor-not-allowed');
            }

            // Function to draw the wheel with equal slices
            function drawWheel() {
                let startAngle = 0;
                ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear canvas before drawing

                wheelConfig.forEach((slice, index) => {
                    const endAngle = startAngle + equalSliceAngle;

                    ctx.beginPath();
                    ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2 - 10, startAngle, endAngle);
                    ctx.lineTo(canvas.width / 2, canvas.height / 2);
                    ctx.fillStyle = slice.color;
                    ctx.fill();
                    ctx.strokeStyle = '#FFFFFF'; // White border for slices
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    // Draw text
                    ctx.save();
                    ctx.translate(canvas.width / 2, canvas.height / 2);
                    ctx.rotate(startAngle + equalSliceAngle / 2); // Rotate to the middle of the current slice
                    ctx.textAlign = 'right';
                    ctx.fillStyle = '#FFFFFF';
                    ctx.font = 'bold 16px Inter'; // Adjust font size as needed
                    ctx.fillText(slice.label, canvas.width / 2 * 0.8, 0); // Position text
                    ctx.restore();

                    startAngle = endAngle;
                });
            }

            // Initial draw
            drawWheel();

            // Spin function
            spinButton.addEventListener('click', () => {
                if (isSpinning || spinButton.disabled) return;

                isSpinning = true;
                spinButton.disabled = true;
                spinButton.textContent = 'SPINNING...';
                spinButton.classList.add('opacity-70', 'cursor-not-allowed');
                resultDisplay.classList.add('hidden'); // Hide previous result
                hideModal(); // Hide modal if open

                // Determine the winning slice based on weighted probability
                let randomValue = Math.random() * totalChance;
                let winningSliceIndex = -1;
                let cumulativeChance = 0;

                for (let i = 0; i < wheelConfig.length; i++) {
                    cumulativeChance += wheelConfig[i].winChance;
                    if (randomValue <= cumulativeChance) {
                        winningSliceIndex = i;
                        break;
                    }
                }

                const winningSlice = wheelConfig[winningSliceIndex];

                // Calculate the target angle for the visually equal slice
                // The pointer needs to land within the visual segment of the winningSliceIndex
                let targetAngleRadians = (winningSliceIndex * equalSliceAngle) + (equalSliceAngle / 2); // Center of the visual slice
                targetAngleRadians += (Math.random() - 0.5) * (equalSliceAngle * 0.8); // Add random offset within the slice (80% of slice width)

                // Convert to degrees for CSS rotation
                let targetAngleDegrees = targetAngleRadians * (180 / Math.PI);

                // Ensure the wheel spins multiple times before stopping
                const spins = 5; // Number of full spins
                // Adjust targetAngleDegrees to make the pointer land correctly (relative to the top, which is 0 degrees)
                // We want the pointer to point at the target angle, so we rotate the wheel by (360 - targetAngleDegrees)
                const finalTargetRotation = (spins * 360) + (360 - targetAngleDegrees);

                canvas.style.transition = 'transform 4s cubic-bezier(0.25, 0.1, 0.25, 1)';
                canvas.style.transform = `rotate(${finalTargetRotation}deg)`;

                // After the transition ends
                canvas.addEventListener('transitionend', () => {
                    isSpinning = false;
                    localStorage.setItem('hasSpunWheel', 'true'); // Mark as spun
                    spinButton.textContent = 'SPUN';
                    spinStatus.textContent = 'You have already spun the wheel. Please close and revisit the browser to spin again.';

                    // Display result in modal
                    showModal(winningSlice);

                    // Reset transform for next potential spin (if page is reloaded)
                    // This is important so the next spin starts from a clean state without accumulated rotation
                    canvas.style.transition = 'none';
                    canvas.style.transform = `rotate(${finalTargetRotation % 360}deg)`; // Keep the final visual rotation
                }, { once: true });
            });

            // Copy coupon functionality for main display (kept for completeness, though modal is primary)
            copyCouponButton.addEventListener('click', () => {
                couponCodeInput.select();
                document.execCommand('copy');
                copyCouponButton.textContent = 'Copied!';
                setTimeout(() => {
                    copyCouponButton.textContent = 'Copy';
                }, 2000);
            });

            // Copy coupon functionality for modal
            modalCopyCouponButton.addEventListener('click', () => {
                modalCouponCodeInput.select();
                document.execCommand('copy');
                modalCopyCouponButton.textContent = 'Copied!';
                setTimeout(() => {
                    modalCopyCouponButton.textContent = 'Copy';
                }, 2000);
            });

            // Modal functions
            function showModal(slice) {
                modalTitle.textContent = slice.type === 'Reward' ? 'Congratulations!' : 'Better Luck Next Time!';
                modalWinnerText.textContent = `You won: ${slice.reward}!`;

                if (slice.type === 'Reward' && slice.couponCode) {
                    modalCouponSection.classList.remove('hidden');
                    modalCouponCodeInput.value = slice.couponCode;
                    modalNoLuckMessage.style.display = 'none';
                } else {
                    modalCouponSection.classList.add('hidden');
                    modalNoLuckMessage.style.display = 'block';
                }
                resultModalOverlay.classList.add('show');
            }

            function hideModal() {
                resultModalOverlay.classList.remove('show');
            }

            closeModalButton.addEventListener('click', hideModal);
            modalCloseButtonBottom.addEventListener('click', hideModal);
            resultModalOverlay.addEventListener('click', (e) => {
                if (e.target === resultModalOverlay) {
                    hideModal();
                }
            });
        });
    </script>
</body>
</html>
